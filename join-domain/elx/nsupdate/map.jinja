{#- Grab the dns_name to use it in the defaults #}
{%- set dns_name = salt.grains.get(
    'join-domain:dns_name',
    salt.pillar.get('join-domain:lookup:dns_name')
) %}

{#- Grab the ddns_server to use it in the defaults #}
{%- set ddns_server = salt.grains.get(
    'join-domain:ddns_server',
    salt.pillar.get('join-domain:lookup:ddns_server')
) %}

{#- Set join-domain defaults for this state #}
{%- load_yaml as defaults %}

ddns_server: ''
dns_domain: ''
dns_name: ''

{%- endload %}


{#-
    Lookup settings in pillar, merging them with defaults, and overriding them
    with grains
#}
{%- set join_domain = salt.pillar.get(
    'join-domain:lookup',
    default = defaults,
    merge = True
) %}


{% do join_domain.update(
    salt.grains.get('join-domain', {})
) %}
